import $ from 'jquery'; 
import axios from 'axios';
import React, { Component } from 'react';
import {geolocated} from 'react-geolocated';
import LocaButton from './LocationButton';
/*global google*/

class SubmitForm extends React.Component {
  constructor(props) {
    super(props);
    this.handleType = this.handleType.bind(this);
    this.handlePrice = this.handlePrice.bind(this);
    this.handleDistance = this.handleDistance.bind(this);
    this.handleSave = this.handleSave.bind(this);
    this.state = {
      typeText: '',
      priceText: '',
      distanceText: '',
    };

  }

  componentDidMount() {
  }


  handleType(event) {
    this.setState({typeText: event.target.value});
  }

  handlePrice(event){
    this.setState({priceText: event.target.value});
  }

  handleDistance(event){
    this.setState({distanceText: event.target.value});
  }


  handleSave(event) {
    var type = (this.state.typeText)
      var distance = (this.state.distanceText)
      var price = (this.state.priceText)
      //$.getJSON("https://maps.googleapis.com/maps/api/place/nearbysearch/json?" + `location=${window.lat},${window.lng}&radius=${distance}&type=${type}&maxprice=${price}&key=${window.apKey}`, {crossdomain: true})
      //.then((response) => {
      //console.log(response);
      //})

      var map;
    var infowindow;

    function initMap() {
      var pyrmont = {lat: window.lat, lng: window.lng};

      map = new google.maps.Map(document.getElementById('map'), {
        center: pyrmont,
        zoom: 15
      });

      infowindow = new google.maps.InfoWindow();
      var service = new google.maps.places.PlacesService(map);
      service.nearbySearch({
        location: pyrmont,
        radius: distance,
        maxprice: price,
        type: [type]
      }, callback);
    }

    function callback(results, status) {
      var thing = []
        results.map(function(a){
        thing.push(a.name)
        thing.push(a.rating)
      })
      debugger;
      if (status === google.maps.places.PlacesServiceStatus.OK) {
        for (var i = 0; i < results.length; i++) {
          createMarker(results[i]);
        }
      }
      debugger;
    }

    function createMarker(place) {
      var placeLoc = place.geometry.location;
      var marker = new google.maps.Marker({
        map: map,
        position: place.geometry.location
      });

      google.maps.event.addListener(marker, 'click', function() {
        infowindow.setContent(place.name);
        infowindow.open(map, this);
      });
    }
    initMap();
  }

  render() {
    return (
        <div> 
        <LocaButton/>
        <form>
        <label>
        Distance:
        <input type="text" value={this.state.distanceText} onChange={this.handleDistance} />
        </label>
        <label>
        Price:
        <select value={this.state.priceText} onChange={this.handlePrice}>
        <option value="0">Price</option>
        <option value="1">$</option>
        <option value="2">$$</option>
        <option value="3">$$$</option>
        <option value="4">$$$$</option>
        </select>
        </label>
        <label>
        Type:
        <select value={this.state.typeText} onChange={this.handleType}>
        <option value="0">Type</option>
        <option value="bar">Bar</option>
        <option value="restaurant">Restaurant</option>
        <option value="cafe">Cafe</option>
        </select>
        </label>
        <button className="save" type="button" onClick=
        {this.handleSave}>Save</button>
    </form>
      <div id="map"></div>
      </div>
      );
  }
}
export default SubmitForm;
